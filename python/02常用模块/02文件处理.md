# 文件处理

#### 文件的存储方式

- 在计算机中，文件是以 二进制 的方式保存在磁盘上的

#### 文本文件和二进制文件

- 文本文件
  - 可以使用 文本编辑软件 查看
  - 本质上还是二进制文件
  - 例如：python 的源程序

- 二进制文件
  - 保存的内容 不是给人直接阅读的，而是 提供给其他软件使用的
  - 例如：图片文件、音频文件、视频文件等等
  - 二进制文件不能使用 文本编辑软件 查看

- 在 Python 中要操作文件需要记住 1 个函数和 3 个方法

|     |       |                 |
| --- | ----- | --------------- |
| 序号  | 函数/方法 | 说明              |
| 01  | open  | 打开文件，并且返回文件操作对象 |
| 02  | read  | 将文件内容读取到内存      |
| 03  | write | 将指定内容写入文件       |
| 04  | close | 关闭文件            |

- open 函数负责打开文件，并且返回文件对象

- read/write/close 三个方法都需要通过 文件对象 来调用

---

## 一、read 方法 —— 读取文件

- open 函数的第一个参数是要打开的文件名（文件名区分大小写）
  - 如果文件 存在，返回 文件操作对象
  - 如果文件 不存在，会 抛出异常

- read 方法可以一次性 读入 并 返回 文件的 所有内容

- close 方法负责 关闭文件
  
  - 如果 忘记关闭文件，会造成系统资源消耗，而且会影响到后续对文件的访问

- 注意：read 方法执行后，会把 文件指针 移动到 文件的末尾（一次性读取完毕，后面继续read没有东了）

```py
# 1. 打开 - 文件名需要注意大小写

file = open("README")

# 2. 读取

text = file.read()

print(text)

# 3. 关闭

file.close()
```

> 提示
> 
> - 在开发中，通常会先编写 打开 和 关闭 的代码，再编写中间针对文件的 读/写 操作！

---

## 二、打开文件的方式

- open 函数默认以 只读方式 打开文件，并且返回文件对象

语法如下：  

```py
f = open("文件名", "访问方式")
```

| 模式 | 描述                                                         |
| ---- | ------------------------------------------------------------ |
| r    | 以只读方式打开文件。文件的指针将会放在文件的开头。这是默认模式。 |
| rb   | 以二进制格式打开一个文件用于只读。文件指针将会放在文件的开头。这是默认模式。 |
| r+   | 打开一个文件用于读写。文件指针将会放在文件的开头。           |
| rb+  | 以二进制格式打开一个文件用于读写。文件指针将会放在文件的开头。 |
| w    | 打开一个文件只用于写入。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。 |
| wb   | 以二进制格式打开一个文件只用于写入。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。 |
| w+   | 打开一个文件用于读写。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。 |
| wb+  | 以二进制格式打开一个文件用于读写。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。 |
| a    | 打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。 |
| ab   | 以二进制格式打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。 |
| a+   | 打开一个文件用于读写。如果该文件已存在，文件指针将会放在文件的结尾。文件打开时会是追加模式。如果该文件不存在，创建新文件用于读写。 |
| ab+  | 以二进制格式打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。如果该文件不存在，创建新文件用于读写。 |

其他可选参数

| 模式      | 描述                             |
| --------- | :------------------------------- |
| encoding= | encoding='UTF-8'指定编码格式打开 |



> 提示
> 
> - 频繁的移动文件指针，会影响文件的读写效率，开发中更多的时候会以 只读、只写 的方式来操作文件

写入文件示例 

```py
# 打开文件

f = open("README", "w")

f.write("hello python！\n")

f.write("今天天气真好")

# 关闭文件

f.close()
```

---

## 2.5 按行读取文件内容

- read 方法默认会把文件的 所有内容 一次性读取到内存

- 如果文件太大，对内存的占用会非常严重

#### readline 方法

- readline 方法可以一次读取一行内容

- 方法执行后，会把 文件指针 移动到下一行，准备再次读取

读取大文件的正确姿势

```py
# 打开文件

file = open("README")

while True:

    # 读取一行内容

    text = file.readline()
    
    # 判断是否读到内容

    if not text:

        break

    # 每读取一行的末尾已经有了一个 `\n`

    print(text, end="")
    
# 关闭文件

file.close()
```

---

## 三、文件/目录的常用管理操作

- 在 终端 / 文件浏览器、 中可以执行常规的 文件 / 目录 管理操作，例如：

- 创建、重命名、删除、改变路径、查看目录内容、……

- 在 Python 中，如果希望通过程序实现上述功能，需要导入 os 模块

#### 1.文件操作

|     |        |       |                        |
| --- | ------ | ----- | ---------------------- |
| 序号  | 方法名    | 说明    | 示例                     |
| 01  | rename | 重命名文件 | os.rename(源文件名, 目标文件名) |
| 02  | remove | 删除文件  | os.remove(文件名)         |

#### 2.目录操作

|     |            |         |                     |
| --- | ---------- | ------- | ------------------- |
| 序号  | 方法名        | 说明      | 示例                  |
| 01  | listdir    | 目录列表    | os.listdir(目录名)     |
| 02  | mkdir      | 创建目录    | os.mkdir(目录名)       |
| 03  | rmdir      | 删除目录    | os.rmdir(目录名)       |
| 04  | getcwd     | 获取当前目录  | os.getcwd()         |
| 05  | chdir      | 修改工作目录  | os.chdir(目标目录)      |
| 06  | path.isdir | 判断是否是文件 | os.path.isdir(文件路径) |

> 提示：文件或者目录操作都支持 相对路径 和 绝对路径

- 判断文件夹是否存在

```python
import os
os.path.exists(test_dir)
#True

os.path.exists(no_exist_dir)
#False
```

- 判断文件是否存在

```python
import os
os.path.exists(test_file.txt)
#True

os.path.exists(no_exist_file.txt)
#False
```
